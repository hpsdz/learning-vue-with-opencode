<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阶段性作业 01 - 简单的待办事项应用</title>
    <!-- 引入 Vue.js (使用 CDN 方式，Vue 3 版本) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        #app {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }
        h1 { text-align: center; color: #333; }
        .input-section { margin-bottom: 20px; display: flex; }
        .input-section input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
            font-size: 1em;
        }
        .input-section button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        .input-section button:hover { background-color: #0056b3; }
        .todo-list ul { list-style: none; padding: 0; }
        .todo-list li {
            background-color: #f9f9f9;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #eee;
            transition: all 0.3s ease;
        }
        .todo-list li.completed {
            text-decoration: line-through;
            color: #888;
            background-color: #e9e9e9;
        }
        .todo-list li span {
            flex-grow: 1;
            margin-left: 10px;
            font-size: 1.1em;
            word-break: break-word; /* 防止文本过长溢出 */
        }
        .todo-list li button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 0.9em;
        }
        .todo-list li button:hover { background-color: #c82333; }
        .filters { margin-top: 20px; text-align: center; }
        .filters button {
            margin: 0 5px;
            padding: 8px 12px;
            border: 1px solid #007bff;
            background-color: white;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .filters button.active {
            background-color: #007bff;
            color: white;
        }
        .info-message {
            text-align: center;
            color: #666;
            margin-top: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>我的待办事项</h1>

        <div class="input-section">
            <!--
                TODO 1: 使用 v-model 绑定 newTodoText 到一个数据属性。
                这会实现输入框和 Vue 实例数据的双向绑定。
            -->
            <input type="text" v-model="newTodoText" placeholder="添加新的待办事项...">
            <!--
                TODO 2: 绑定一个 @click 事件到按钮，调用 addTodo 方法。
                当点击按钮时，会执行 addTodo 方法。
            -->
            <button @click="addTodo">添加</button>
        </div>

        <div class="todo-list">
            <ul>
                <!--
                    TODO 3: 使用 v-for 遍历 todos 数组 (或 filteredTodos 计算属性)。
                    每个 `todo` 对象应包含 `id`, `text`, `completed` 属性。
                    Vue 会为数组中的每个 `todo` 对象渲染一个 `<li>` 元素。
                -->
                <!--
                    TODO 4: 为每个 `<li>` 元素绑定 `:key` (例如 `:key="todo.id"`)，
                    这有助于 Vue 高效地更新列表。
                    同时，根据 `todo.completed` 属性动态绑定 class (例如 `:class="{ completed: todo.completed }"`)。
                -->
                <li v-for="(todo, index) in filteredTodos" :key="filteredTodos.id">
                    <!--
                        TODO 5: 绑定 @change 事件到复选框，调用 toggleTodoStatus 方法，
                        并传入当前待办事项的 ID (例如 `@change="toggleTodoStatus(todo.id)"`)。
                        这将用于切换待办事项的完成状态。
                    -->
                    <!--
                        TODO 6: 使用 v-model 绑定复选框到 `todo.completed` 属性。
                        这会实现复选框状态和 `todo.completed` 属性的双向绑定。
                    -->
                    <input type="checkbox" @change="toggleTodoStatus(todo.id)" v-model="todo.completed">
                    <!--
                        TODO 7: 使用 {{ }} (Mustache 语法) 显示 todo 的文本内容 (例如 `{{ todo.text }}`)。
                    -->
                    <span>待办事项内容: {{ todo.text }}</span>
                    <!--
                        TODO 8: 绑定 @click 事件到删除按钮，调用 removeTodo 方法，
                        并传入当前待办事项的 ID (例如 `@click="removeTodo(todo.id)"`)。
                    -->
                    <button @click="removeTodo(todo.id)">删除</button>
                </li>
                <!--
                    TODO 9: 使用 v-if 指令在 `todos` 列表 (或 `filteredTodos` 列表) 为空时，
                    显示一个提示信息 (例如 `v-if="filteredTodos.length === 0"`)。
                -->
                <p class="info-message" v-if="filteredTodos.length === 0">当前没有待办事项！</p>
            </ul>
        </div>

        <div class="filters">
            <!--
                TODO 10: 绑定 @click 事件到筛选按钮，调用 setFilter 方法，
                并传入相应的筛选状态 (例如 `'all'`, `'active'`, `'completed'`)。
            -->
            <!--
                TODO 11: 根据当前的 `filter` 状态，动态绑定 `active` class。
                例如 `:class=c`)。
            -->
            <button :class="{ active: filter === 'all' }" @click="setFilter('all')">全部</button>
            <button :class="{ active: filter === 'active' }" @click="setFilter('active')">待完成</button>
            <button :class="{ active: filter === 'completed' }" @click="setFilter('completed')">已完成</button>
        </div>

        <p class="info-message">
            <!--
                TODO 12: 使用一个 computed 属性 (例如 `remainingTodosCount`) 来显示剩余待完成事项的数量。
                使用 {{ }} 显示该计算属性的值。
            -->
            还有 <span> {{ remainingTodosCount }} </span> 个待完成事项。
        </p>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    // TODO 13: 定义 todos 数组。
                    // 每个 todo 对象应包含：
                    //   - id: 唯一的标识符 (建议使用当前时间戳或自增 ID)
                    //   - text: 待办事项的文本内容
                    //   - completed: 布尔值，表示是否已完成
                    todos: [
                        {id: 0, text: '吃饭', completed: false}
                    ],
                    // TODO 14: 定义 newTodoText 字符串，用于绑定新增待办事项的输入框。
                    newTodoText: '',
                    // TODO 15: 定义 filter 状态 (例如，'all', 'active', 'completed')，用于控制待办事项的显示。
                    filter: 'all'
                };
            },
            computed: {
                // TODO 16: 定义 filteredTodos 计算属性。
                // 根据当前的 `filter` 状态 (this.filter) 返回过滤后的待办事项数组。
                // 例如：
                // if (this.filter === 'active') {
                //    return this.todos.filter(todo => !todo.completed);
                // } else if (this.filter === 'completed') {
                //    return this.todos.filter(todo => todo.completed);
                // }
                // return this.todos; // 如果是 'all'，则返回所有 todos
                filteredTodos() {
                    if (this.filter === 'all') {
                        return this.todos;
                    } else if (this.filter === 'active') {
                        return this.todos.filter(todo => !todo.completed);
                    } else {
                        return this.todos.filter(todo => todo.completed);
                    }
                },
                // TODO 17: 定义 remainingTodosCount 计算属性。
                // 返回 `todos` 数组中 `completed` 为 false (即未完成) 的事项数量。
                remainingTodosCount() {
                    return this.todos.filter(todo => !todo.completed).length;
                }
            },
            methods: {
                // TODO 18: 实现 addTodo 方法。
                // 1. 检查 `newTodoText` 是否为空。如果为空，可以弹窗提示或不进行操作。
                // 2. 创建一个新的 todo 对象，包含一个唯一的 `id` (例如 `Date.now()`)，`text` 为 `newTodoText`，`completed` 为 `false`。
                // 3. 将新 todo 对象添加到 `this.todos` 数组的开头或结尾。
                // 4. 清空 `newTodoText`，以便用户可以输入下一个待办事项。
                addTodo() {
                    if (this.newTodoText.trim() === '') {
                        alert("请输入TODO!");
                        return;
                    }
                    var newId = this.todos.length > 0 ? Math.max(...this.todos.map(todo => todo.id)) + 1 : 1;
                    this.todos.push({ id: newId, text: this.newTodoText, completed: false })
                    // console.log('TODO: 实现 addTodo 方法');
                },
                // TODO 19: 实现 toggleTodoStatus 方法。
                // 接收一个 `todoId` 参数。
                // 遍历 `this.todos` 数组，找到 `id` 匹配的 todo 对象，然后切换其 `completed` 属性的值。
                toggleTodoStatus(todoId) {
                    var todo = this.todos.find(t => t.id === todoId);
                    if (todo) {
                    // 如果找到了，则切换其 completed 属性
                        //todo.completed = !todo.completed;
                        console.log(todo.completed);
                    }
                    //console.log(`TODO: 实现 toggleTodoStatus 方法，切换 ID 为 ${todoId} 的事项状态`);
                },
                // TODO 20: 实现 removeTodo 方法。
                // 接收一个 `todoId` 参数。
                // 从 `this.todos` 数组中移除 `id` 匹配的 todo 对象。
                // 提示：可以使用数组的 `filter` 方法。
                removeTodo(todoId) {
                    //console.log(`TODO: 实现 removeTodo 方法，删除 ID 为 ${todoId} 的事项`);
                    this.todos = this.todos.filter(todo => todo.id !== todoId);
                },
                // TODO 21: 实现 setFilter 方法。
                // 接收一个 `newFilter` 字符串参数 ('all', 'active', 'completed')。
                // 将 `this.filter` 的值更新为 `newFilter`。
                setFilter(newFilter) {
                    this.filter = newFilter;
                    // console.log(`TODO: 实现 setFilter 方法，设置筛选器为 ${newFilter}`);
                }
            },
            // TODO 22 (可选): 使用 `watch` 选项来侦听 `todos` 数组的变化。
            // 当 `todos` 数组发生变化时，将最新的 `todos` 数组保存到浏览器的 `localStorage` 中，实现数据持久化。
            // `deep: true` 选项用于深度侦听数组内部对象属性的变化。
            watch: {
                todos: {
                    handler(newTodos) {
                        // localStorage.setItem('todos', JSON.stringify(newTodos));
                        console.log('TODO (可选): todos 数组发生变化，保存到 localStorage');
                    },
                    deep: true
                }
            },
            // TODO 23 (可选): 在 `mounted` 生命周期钩子中从 `localStorage` 加载数据。
            // `mounted` 钩子在 Vue 实例挂载到 DOM 后立即调用。
            // 在这里，你可以尝试从 `localStorage` 中读取之前保存的 todos 数据，并将其赋值给 `this.todos`。
            mounted() {
                // const savedTodos = localStorage.getItem('todos');
                // if (savedTodos) {
                //     this.todos = JSON.parse(savedTodos);
                // }
                console.log('TODO (可选): 在 mounted 钩子中从 localStorage 加载数据');
            }
        });

        app.mount('#app');
    </script>
</body>
</html>